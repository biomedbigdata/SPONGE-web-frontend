<p></p>
<mat-card class="cancer-select-card">
  <mat-card-header>
    <div mat-card-avatar class="circle">1</div>
    <mat-card-title>Cancer type</mat-card-title>
    <mat-card-subtitle>
      Choose a TCGA cancer type that fits your expression data
    </mat-card-subtitle>
    <div class="sub-type-header">
      <mat-card-title style="margin-left: 30px">Available sub-types</mat-card-title>
      <mat-card-subtitle style="margin-left: 30px">
        Select available sub-types for the chosen cancer that fit your data
      </mat-card-subtitle>
    </div>
  </mat-card-header>
  <mat-card-content>
    <mat-grid-list cols="4" rowHeight="100px">
      <mat-grid-tile [colspan]="2" [rowspan]="1">
        <div class="cancer-select">
          <mat-form-field>
            <mat-label>Select a cancer type:</mat-label>
            <mat-select [(ngModel)]="selectedCancer" name="cancer" (change)="clear()">
              <mat-option *ngFor="let cancer of cancers" [value]="cancer">
                {{cancer.toString()}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-grid-tile>
      <mat-grid-tile [colspan]="2" [rowspan]="2">
        <div class="chip-box">
          <mat-chip-list>
            <mat-chip *ngFor="let subType of selectedCancer.allSubTypes"
                      (click)="selectGroup(subType)"
                      style="{{groupIsSelected(subType)}}">
              {{subType}}
            </mat-chip>
          </mat-chip-list>
        </div>
      </mat-grid-tile>
      <mat-grid-tile [colspan]="2" [rowspan]="1">
        <div class="cancer-select">
          <mat-form-field>
            <mat-label>Select sub-type level:</mat-label>
            <mat-select [(ngModel)]="selectedLevel" name="level">
              <mat-option *ngFor="let level of levels" [value]="level">
                {{level}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-grid-tile>
    </mat-grid-list>
  </mat-card-content>
</mat-card>

<p></p>
<mat-card class="meta-upload-card">
  <mat-card-header>
    <div mat-card-avatar class="circle">3</div>
    <mat-card-title>Meta information</mat-card-title>
    <mat-card-subtitle>
      Upload a description of the expression samples or manually group the samples in your expression file
    </mat-card-subtitle>
    <div class="button-container">
      <button mat-raised-button (click)="flipMetaExample()">
        {{buttonText('meta')}}
      </button>
      <p></p>
      <button mat-raised-button (click)="flipAssignMetaManual()">
        {{buttonText('manual')}}
      </button>
    </div>
  </mat-card-header>
  <mat-card-content>
    <ng-container *ngIf="showMetaExample">
      <table mat-table [dataSource]="exampleMetaData" class="mat-elevation-z8">
        <ng-container [matColumnDef]="column" *ngFor="let column of displayedMetaCols">
          <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
          <td mat-cell *matCellDef="let emp">{{ emp[column] }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedMetaCols"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedMetaCols"></tr>
      </table>
    </ng-container>
    <!-- MANUAL SAMPLE ASSIGN -->
    <ng-container *ngIf="assignMetaManual">
      <mat-grid-list cols="4" rowHeight="100px">
        <mat-grid-tile [colspan]="2" [rowspan]="0.5">
          <h5>Samples:</h5>
          <mat-form-field style="margin-left: 20px">
            <mat-label>Filter</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Search samples" #input>
          </mat-form-field>
        </mat-grid-tile>
        <mat-grid-tile [colspan]="2" [rowspan]="0.5">
          <h5>Sub-types:</h5>
          <button mat-raised-button
                  (click)="addSamplesToGroup()"
                  style="margin-left: 20px">
            Add samples
          </button>
          <button mat-raised-button
                  (click)="removeSamplesFromGroup()"
                  style="margin-left: 20px">
            Remove samples
          </button>
        </mat-grid-tile>
        <mat-grid-tile [colspan]="2" [rowspan]="4">
          <div class="sample-select-box">
            <table mat-table [dataSource]="samplesData" class="mat-elevation-z8">
              <!-- Checkbox Column -->
              <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef>
                  <mat-checkbox (change)="$event ? toggleAllRows() : null"
                                [checked]="selectedSamples.hasValue() && isAllSelected()"
                                [indeterminate]="selectedSamples.hasValue() && !isAllSelected()">
                  </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row">
                  <mat-checkbox (click)="$event.stopPropagation()"
                                (change)="$event ? selectedSamples.toggle(row) : null"
                                [checked]="selectedSamples.isSelected(row)">
                  </mat-checkbox>
                </td>
              </ng-container>
              <!-- Sample columns -->
              <ng-container [matColumnDef]="column" *ngFor="let column of displayedMetaCols">
                <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
                <td mat-cell *matCellDef="let emp">{{ emp[column] }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="samplesSelectColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: samplesSelectColumns;"
                  (click)="selectedSamples.toggle(row)"></tr>
              <!-- Row shown when there is no matching data. -->
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
              </tr>
            </table>
          </div>
        </mat-grid-tile>
        <mat-grid-tile [colspan]="2" [rowspan]="4">
          <div class="sample-select-box">
            <mat-chip-list>
              <mat-chip *ngFor="let group of getSelectedGroups()"
                        (click)="setGroupToFill(group)"
                        style="{{setToFillChipStyle(group)}}">
                {{group}} ({{getGroupSize(group)}} samples)
              </mat-chip>
            </mat-chip-list>
          </div>
        </mat-grid-tile>
      </mat-grid-list>
    </ng-container>
    <!-- META FILE UPLOAD -->
    <ng-container *ngIf="!assignMetaManual">
      <ngx-dropzone (change)="onSelectMeta($event)"
                    multiple="false"
                    accept="{{acceptMetaFiles()}}"
                    maxFileSize="500000"
                    disableClick="{{metaUploaded()}}">
        <ngx-dropzone-label>
          Drop your meta file here!
          <img src="../../../assets/img/metaUpload.png" width="15%" height="15%">
          Or click the icon to select a file
        </ngx-dropzone-label>
        <ngx-dropzone-preview *ngFor="let f of uploadedMetaFiles"
                              [removable]="true" (removed)="onRemoveMeta(f)">
          <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
        </ngx-dropzone-preview>
      </ngx-dropzone>
    </ng-container>
    <ng-container *ngIf="metaUploaded()">
      <mat-grid-list cols="4" rowHeight="100px">
        <mat-grid-tile colspan="2" rowspan="1">
          <div class="cancer-select">
            <mat-form-field>
              <mat-label>Select sub-type column in meta file:</mat-label>
              <mat-select [(ngModel)]="conditionField" name="level">
                <mat-option *ngFor="let column of uploadedMetaColumns" [value]="column">
                  {{column}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </mat-grid-tile>
      </mat-grid-list>
    </ng-container>
  </mat-card-content>
</mat-card>
